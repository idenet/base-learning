# 前端组件化

## 一个简单例子的反思 -- 点赞

### 复用

**思考**：一个 dom 结构+js 构成的点赞功能，如果需要复用该怎么办。

**思路**：可以用纯 js 的方法，将 dom 结构写成字符串后，通过 innerHTML 插入 dom

**解决**：构造一个类，类中有 render 方法，render 方法返回 dom 字符串，需要的只要实例化类就能使用 render 方法插入 dom

**思考**：dom 结构已经可以构建出来类，那么怎么往字符串中添加 dom 事件呢？

**思路**：只要获取插入字符串的 dom 结构就能够插入 dom 事件

**解决**：构建一个函数，先创建 dom 结构再插入

### 组件化

**思考**：点击修改内容

**思路**：因为是需要完全组件化的，那么更改的方法应该放在类中。大部分事件其实是对状态修改，那么可以在构造函数中保存一个对象来对这个组件的所有状态进行统一维护（state

**解决**：获取 dom 结构，根据 state 来修改内容

### 优化 dom 操作

**思考**：观察 changeLikeText 方法，其中有 dom 操作。在真实的项目中一个组件必然有很多 dom 操作，那么这么做就会在每个方法中，出现很多 dom 操作，这是非常不好的，会让组件中方法的管理变得混乱

**思路**：一旦状态改变，就调用 render 方法进行重新渲染。

**总结**：像这样 change 方法调用 setState 函数，改变 state 的状态并且调用 render 方法，render 方法重新组成字符串

**思考**：很显然这里并没有将新 render 的字符串插入到 dom

**思路**：在 setState 方法中将字符串插入到 dom

**总结**：在类中实现一个方法，插入新字符串，删除旧字符串。在 setState 中调用这个方法.

**注意**: 很明显，这种操作会让浏览器进行大量重排，严重影响性能，但是三种 mvvm 框架都使用 virtual dom 规避类这种影响

### 抽象公共类

**思考**：有哪些是可以抽象的？

**思路**：如果有很多个组件，那么组件中相同的地方就可以抽象，setState、render 函数、onStateChange 都是可抽象的

**总结**：通过 ES6 的 class 语法，继承抽象的组件，就能很简单的实现一个业务组件。并且可以通过传入配置对象，来对组件进行自定义

## 列表循环

在react中循环列表一般用父组件map来循环出每个对象，在子组建中渲染；和vue一样因为使用virturldom所以最好在循环中使用唯一的数据作为key

**注意**：key最好别用index去做，因为在删除插入的时候，index的值是会变的
